import{r as g}from"./http-DtPS8xaZ.js";import{u as M,r as R}from"./index-D57M42sx.js";import{a as c}from"./ant-design-vue-BsThXQyf.js";import{d as E,r as v,a as F,o as G,a2 as N,c as a,$ as r,Z as l,a5 as I,Y as O,G as i,a1 as U,_}from"./@vue-DQ8ziMgL.js";import{_ as T}from"./plugin-vueexport-helper-DlAUqK2U.js";import"./axios-NIGUFBhG.js";import"./pinia-uvDSw88s.js";import"./vue-router-Bnt47Z6A.js";import"./@babel-Bq4_u9L9.js";import"./@ant-design-DeQVn8T2.js";import"./@ctrl-DOFZgDuz.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-D5iaQeiq.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./lodash-es-DnYq9fPm.js";import"./dayjs-Ct77qKTJ.js";import"./async-validator-CRx4dHSJ.js";import"./throttle-debounce-CUWDS_la.js";function Y(m){return g.post("/user/login",m)}function Z(m){return g.post("/user/register",m)}function $(){return g.get("/university/getAll")}const j={class:"login-container"},z={key:0},H=E({__name:"LoginRegister",setup(m){const k=M(),o=v(!0),t=F({username:"",password:"",role:void 0,universityId:null,managerName:""}),f=v([]),C=(n,e)=>e.label.includes(n),q={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],managerName:[{required:!0,message:"请输入管理员姓名",trigger:"blur"}],universityId:[{required:!0,message:"请输入所属学校",trigger:"blur"}]},p=v(!1);function x(){o.value=!o.value}const L=n=>{console.log(n)};async function S(){p.value=!0;try{if(o.value){const n=await Y({username:t.username,password:t.password});k.setLoginUserInfo(n),c.success("登录成功"),await R.push("/")}else{if(!t.role){c.error("请选择角色"),p.value=!1;return}await Z({username:t.username,password:t.password,role:t.role,managerName:t.managerName,universityId:t.universityId}),c.success("注册成功"),o.value=!0}}catch{}finally{p.value=!1}}const h=async()=>{const n=await $();f.value=n.map(e=>({label:e.universityName,value:e.id}))};return G(()=>{h()}),(n,e)=>{const y=l("a-input"),u=l("a-form-item"),B=l("a-input-password"),w=l("a-select"),d=l("a-select-option"),b=l("a-button"),D=l("a-space"),V=l("a-form"),A=l("a-card");return _(),N("div",j,[a(A,{class:"login-card",title:o.value?"用户登录":"用户注册"},{default:r(()=>[a(V,{model:t,rules:q,layout:"vertical",onFinish:S},{default:r(()=>[a(u,{label:"用户名",name:"username"},{default:r(()=>[a(y,{value:t.username,"onUpdate:value":e[0]||(e[0]=s=>t.username=s),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),a(u,{label:"密码",name:"password"},{default:r(()=>[a(B,{value:t.password,"onUpdate:value":e[1]||(e[1]=s=>t.password=s),placeholder:"请输入密码"},null,8,["value"])]),_:1}),t.role=="1"&&!o.value?(_(),N("div",z,[a(u,{label:"管理员姓名",name:"managerName"},{default:r(()=>[a(y,{value:t.managerName,"onUpdate:value":e[2]||(e[2]=s=>t.managerName=s),placeholder:"请输入管理员姓名"},null,8,["value"])]),_:1}),a(u,{label:"所属大学",name:"universityId"},{default:r(()=>[a(w,{value:t.universityId,"onUpdate:value":e[3]||(e[3]=s=>t.universityId=s),"show-search":"",style:{width:"100%"},"filter-option":C,options:f.value,onChange:L},null,8,["value","options"])]),_:1})])):I("",!0),o.value?I("",!0):(_(),O(u,{key:1,label:"角色",name:"role",rules:[{required:!0,message:"请选择角色",trigger:"change"}]},{default:r(()=>[a(w,{value:t.role,"onUpdate:value":e[4]||(e[4]=s=>t.role=s),placeholder:"请选择角色","allow-clear":""},{default:r(()=>[a(d,{value:1},{default:r(()=>e[5]||(e[5]=[i("管理员",-1)])),_:1,__:[5]}),a(d,{value:2},{default:r(()=>e[6]||(e[6]=[i("教师",-1)])),_:1,__:[6]}),a(d,{value:3},{default:r(()=>e[7]||(e[7]=[i("学生",-1)])),_:1,__:[7]})]),_:1},8,["value"])]),_:1})),a(u,null,{default:r(()=>[a(D,null,{default:r(()=>[a(b,{type:"primary","html-type":"submit",loading:p.value},{default:r(()=>[i(U(o.value?"登录":"注册"),1)]),_:1},8,["loading"]),a(b,{type:"link",onClick:x},{default:r(()=>[i(U(o.value?"没有账号？去注册":"已有账号？去登录"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])])}}}),ge=T(H,[["__scopeId","data-v-12cce2e0"]]);export{ge as default};
