import{d as z,a as T,r as y,o as Z,Y as B,$ as t,B as J,Z as u,c as a,G as d,_ as p,a2 as w,a0 as G,F,a3 as A,a1 as D,a5 as H}from"./@vue-DQ8ziMgL.js";import{r as S}from"./http-DtPS8xaZ.js";import{u as K}from"./index-ZA2RPwAl.js";import{d as ie}from"./dayjs-Ct77qKTJ.js";import{a as f,M as pe}from"./ant-design-vue-BsThXQyf.js";import"./axios-NIGUFBhG.js";import"./pinia-uvDSw88s.js";import"./vue-router-Bnt47Z6A.js";import"./@babel-Bq4_u9L9.js";import"./@ant-design-DeQVn8T2.js";import"./@ctrl-DOFZgDuz.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-D5iaQeiq.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./lodash-es-DnYq9fPm.js";import"./async-validator-CRx4dHSJ.js";import"./throttle-debounce-CUWDS_la.js";function Q(i){return S.get("/manager/class/getClassByUniversityId",{params:{universityId:i}})}const ce=z({__name:"StudentComp",setup(i){const _=K(),n=T({studentName:"",studentNo:"",classId:void 0}),U=y([]),$=async()=>{if(!_.loginUserInfo||!_.loginUserInfo.universityId)return;const h=await Q(_.loginUserInfo.universityId);U.value=h.map(s=>({label:s.className,value:s.classId}))||[]},b=async()=>{},L=async()=>{await $()};return Z(()=>{L()}),(h,s)=>{const c=u("a-input"),C=u("a-form-item"),Y=u("a-select"),g=u("a-button"),r=u("a-form");return p(),B(r,{layout:"inline",onSubmit:J(b,["prevent"])},{default:t(()=>[a(C,{label:"学生姓名"},{default:t(()=>[a(c,{value:n.studentName,"onUpdate:value":s[0]||(s[0]=N=>n.studentName=N),placeholder:"请输入学生姓名（支持模糊搜索）","allow-clear":""},null,8,["value"])]),_:1}),a(C,{label:"学生学号"},{default:t(()=>[a(c,{value:n.studentNo,"onUpdate:value":s[1]||(s[1]=N=>n.studentNo=N),placeholder:"请输入学生学号","allow-clear":""},null,8,["value"])]),_:1}),a(C,{label:"学生班级"},{default:t(()=>[a(Y,{value:n.classId,"onUpdate:value":s[2]||(s[2]=N=>n.classId=N),options:U.value,placeholder:"请选择学生班级","allow-clear":""},null,8,["value","options"])]),_:1}),a(C,null,{default:t(()=>[a(g,{type:"primary","html-type":"submit"},{default:t(()=>s[3]||(s[3]=[d("搜索",-1)])),_:1,__:[3]})]),_:1})]),_:1})}}});function me(i){return S.post("/manager/teacher/edit",i)}function ve(i){return S.get("/manager/teacher/delete",{params:{teacherId:i}})}function fe(i,_,n){return S.post(`/manager/teacher/list/${i}/${_}`,n)}function _e(i){return S.get("/manager/course/getCourseByUniversityId",{params:{universityId:i}})}const ye={key:0,style:{"margin-top":"16px"}},he={key:1,style:{color:"red","margin-top":"16px"}},Ce=z({__name:"TeacherComp",setup(i){const _=K(),n=y(!1),U=y([]),$=y([]),b=y([]),L=y(!1),h=y(""),s=T({current:1,pageSize:10,total:0,showTotal:l=>`共 ${l} 条`}),c=T({teacherNo:"",teacherName:"",teacherGender:""}),C=y([]),Y=[{title:"教师编号",dataIndex:"teacherNo",key:"teacherNo"},{title:"姓名",dataIndex:"teacherName",key:"teacherName"},{title:"生日",dataIndex:"teacherBirthday",key:"teacherBirthday"},{title:"性别",dataIndex:"teacherGender",key:"teacherGender"},{title:"班级与课程",dataIndex:"teacherOwnerClassCourse",key:"courses"},{title:"操作",key:"actions",width:150}],g=y(!1),r=T({teacherId:0,teacherNo:"",teacherName:"",teacherBirthday:null,teacherGender:"",selectClassCourse:[]}),N=()=>{},R=l=>{l.file.status!=="uploading"&&console.log(l.file,l.fileList),l.file.status==="done"?(console.log(l.file.response,"上传结果"),l.file.response.code===200?(f.success("教师数据导入成功"),n.value=!1,x()):(h.value=l.file.response.message||"导入失败，请重试",f.error(h.value),b.value=[],n.value=!1,h.value="")):l.file.status==="error"&&f.error(`${l.file.name} file upload failed.`)},x=async()=>{try{const l=await fe(s.current,s.pageSize,c);U.value=l.records,s.total=l.total}catch{f.error("加载教师列表失败")}},W=async()=>{try{const l=await Q(_.loginUserInfo?.universityId);C.value=l.map(e=>({label:e.className,value:e.classId}))}catch{f.error("班级数据加载失败")}},V=()=>{s.current=1,x()},X=l=>{s.current=l.current,s.pageSize=l.pageSize,x()},ee=l=>{console.log(l),r.teacherId=l.teacherId,r.teacherNo=l.teacherNo,r.teacherName=l.teacherName,r.teacherGender=l.teacherGender,r.teacherBirthday=l.teacherBirthday?ie(l.teacherBirthday):null,r.selectClassCourse=l.teacherOwnerClassCourse,g.value=!0},ae=async()=>{try{await me({teacherId:r.teacherId,teacherNo:r.teacherNo,teacherName:r.teacherName,teacherGender:r.teacherGender,teacherBirthday:r.teacherBirthday?r.teacherBirthday.format("YYYY-MM-DD"):null,selectClassCourse:r.selectClassCourse}),f.success("编辑成功"),g.value=!1,x()}catch{f.error("编辑失败")}},te=async()=>{try{const l=await _e(_.loginUserInfo?.universityId);console.log(l,"res"),$.value=l.map(e=>({label:e.courseName,value:e.id}))}catch{f.error("课程数据加载失败")}},le=()=>{g.value=!1},oe=l=>{pe.confirm({title:"确认删除该教师吗？",async onOk(){try{await ve(l),f.success("删除成功"),x()}catch{f.error("删除失败")}}})};return Z(()=>{x(),W(),te()}),(l,e)=>{const E=u("a-input"),m=u("a-form-item"),O=u("a-select-option"),M=u("a-select"),k=u("a-button"),P=u("a-form"),re=u("a-tag"),j=u("a-space"),ne=u("a-table"),se=u("a-upload"),q=u("a-modal"),ue=u("a-date-picker"),de=u("a-card");return p(),w("div",null,[a(P,{layout:"inline",onSubmit:J(V,["prevent"])},{default:t(()=>[a(m,{label:"教师编号"},{default:t(()=>[a(E,{value:c.teacherNo,"onUpdate:value":e[0]||(e[0]=o=>c.teacherNo=o),placeholder:"请输入教师编号","allow-clear":""},null,8,["value"])]),_:1}),a(m,{label:"教师姓名"},{default:t(()=>[a(E,{value:c.teacherName,"onUpdate:value":e[1]||(e[1]=o=>c.teacherName=o),placeholder:"请输入教师姓名","allow-clear":""},null,8,["value"])]),_:1}),a(m,{label:"性别"},{default:t(()=>[a(M,{value:c.teacherGender,"onUpdate:value":e[2]||(e[2]=o=>c.teacherGender=o),placeholder:"选择性别","allow-clear":"",style:{width:"120px"}},{default:t(()=>[a(O,{value:"男"},{default:t(()=>e[13]||(e[13]=[d("男",-1)])),_:1,__:[13]}),a(O,{value:"女"},{default:t(()=>e[14]||(e[14]=[d("女",-1)])),_:1,__:[14]})]),_:1},8,["value"])]),_:1}),a(m,null,{default:t(()=>[a(k,{type:"primary",onClick:V},{default:t(()=>e[15]||(e[15]=[d("查询",-1)])),_:1,__:[15]})]),_:1}),a(m,null,{default:t(()=>[a(k,{onClick:e[3]||(e[3]=o=>n.value=!0)},{default:t(()=>e[16]||(e[16]=[d("导入教师数据",-1)])),_:1,__:[16]})]),_:1}),a(m,null,{default:t(()=>e[17]||(e[17]=[G("a",{href:"/ai-grader-front/file/teacher-upload.xlsx",download:"教师上传模板.xlsx"},"下载示例模板",-1)])),_:1,__:[17]})]),_:1}),a(ne,{columns:Y,"data-source":U.value,pagination:s,"row-key":"teacherId",bordered:"",onChange:X,style:{"margin-top":"16px"}},{bodyCell:t(({column:o,record:I})=>[o.key==="courses"?(p(),B(j,{key:0,wrap:""},{default:t(()=>[(p(!0),w(F,null,A(I.teacherOwnerClassCourse,v=>(p(),B(re,{key:`${v.classId}-${v.courseId}`},{default:t(()=>[d(D(v.className)+" - "+D(v.courseName),1)]),_:2},1024))),128))]),_:2},1024)):o.key==="actions"?(p(),B(j,{key:1},{default:t(()=>[a(k,{type:"link",onClick:v=>ee(I)},{default:t(()=>e[18]||(e[18]=[d("编辑",-1)])),_:2,__:[18]},1032,["onClick"]),a(k,{type:"link",danger:"",onClick:v=>oe(I.teacherId)},{default:t(()=>e[19]||(e[19]=[d("删除",-1)])),_:2,__:[19]},1032,["onClick"])]),_:2},1024)):(p(),w(F,{key:2},[d(D(I[o.dataIndex]),1)],64))]),_:1},8,["data-source","pagination"]),a(q,{open:n.value,"onUpdate:open":e[5]||(e[5]=o=>n.value=o),title:"导入教师数据",onOk:N,onCancel:e[6]||(e[6]=()=>n.value=!1),"ok-text":"确定","cancel-text":"取消"},{default:t(()=>[a(se,{action:"http://localhost:8080/manager/teacher/addByExcel",accept:".xlsx, .xls","file-list":b.value,"onUpdate:fileList":e[4]||(e[4]=o=>b.value=o),name:"file",onChange:R},{default:t(()=>[a(k,{type:"primary"},{default:t(()=>e[20]||(e[20]=[d("选择文件",-1)])),_:1,__:[20]})]),_:1},8,["file-list"]),L.value?(p(),w("div",ye,"正在上传...")):H("",!0),h.value?(p(),w("div",he,D(h.value),1)):H("",!0)]),_:1},8,["open"]),a(q,{open:g.value,"onUpdate:open":e[12]||(e[12]=o=>g.value=o),title:"编辑教师",onOk:ae,onCancel:le,destroyOnClose:""},{default:t(()=>[a(P,{model:r,"label-col":{span:5},"wrapper-col":{span:16}},{default:t(()=>[a(m,{label:"教师编号"},{default:t(()=>[a(E,{value:r.teacherNo,"onUpdate:value":e[7]||(e[7]=o=>r.teacherNo=o)},null,8,["value"])]),_:1}),a(m,{label:"姓名"},{default:t(()=>[a(E,{value:r.teacherName,"onUpdate:value":e[8]||(e[8]=o=>r.teacherName=o)},null,8,["value"])]),_:1}),a(m,{label:"生日"},{default:t(()=>[a(ue,{value:r.teacherBirthday,"onUpdate:value":e[9]||(e[9]=o=>r.teacherBirthday=o),style:{width:"100%"}},null,8,["value"])]),_:1}),a(m,{label:"性别"},{default:t(()=>[a(M,{value:r.teacherGender,"onUpdate:value":e[10]||(e[10]=o=>r.teacherGender=o),style:{width:"100%"}},{default:t(()=>[a(O,{value:"男"},{default:t(()=>e[21]||(e[21]=[d("男",-1)])),_:1,__:[21]}),a(O,{value:"女"},{default:t(()=>e[22]||(e[22]=[d("女",-1)])),_:1,__:[22]})]),_:1},8,["value"])]),_:1}),e[25]||(e[25]=G("div",null,"教师授课情况",-1)),(p(!0),w(F,null,A(r.selectClassCourse,(o,I)=>(p(),B(de,{key:I},{default:t(()=>[G("div",null,[a(M,{value:o.classId,"onUpdate:value":v=>o.classId=v,"show-search":"",options:C.value,placeholder:"选择教师的班级",style:{width:"200px"}},null,8,["value","onUpdate:value","options"]),a(M,{value:o.courseId,"onUpdate:value":v=>o.courseId=v,"show-search":"",options:$.value,placeholder:"选择教师的课程",style:{width:"200px"}},null,8,["value","onUpdate:value","options"]),a(k,{onClick:()=>r.selectClassCourse.splice(I,1)},{default:t(()=>e[23]||(e[23]=[d("删除",-1)])),_:2,__:[23]},1032,["onClick"])])]),_:2},1024))),128)),a(k,{onClick:e[11]||(e[11]=()=>r.selectClassCourse.push({className:"",courseName:""}))},{default:t(()=>e[24]||(e[24]=[d("新增",-1)])),_:1,__:[24]})]),_:1,__:[25]},8,["model"])]),_:1},8,["open"])])}}}),Ve=z({__name:"PeopleManage",setup(i){return(_,n)=>(p(),w(F,null,[n[0]||(n[0]=G("div",{class:"ant-h2-title"}," 教师管理 ",-1)),a(Ce),n[1]||(n[1]=G("div",{class:"ant-h2-title"}," 学生管理 ",-1)),a(ce)],64))}});export{Ve as default};
