import{h as pe,d as J,a as $,r as _,o as ae,a2 as w,F as T,c as e,Z as s,B as le,$ as l,u as ce,G as d,a0 as D,_ as m,Y as P,a3 as X,a1 as j,a5 as ee}from"./@vue-DQ8ziMgL.js";import{r as S}from"./http-DtPS8xaZ.js";import{u as ne}from"./index-d2G0Ovz8.js";import{a as f,M as me}from"./ant-design-vue-BsThXQyf.js";import{d as ve}from"./dayjs-Ct77qKTJ.js";import"./axios-NIGUFBhG.js";import"./pinia-uvDSw88s.js";import"./vue-router-Bnt47Z6A.js";import"./@babel-Bq4_u9L9.js";import"./@ant-design-DeQVn8T2.js";import"./@ctrl-DOFZgDuz.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-D5iaQeiq.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./lodash-es-DnYq9fPm.js";import"./async-validator-CRx4dHSJ.js";import"./throttle-debounce-CUWDS_la.js";function oe(i){return S.get("/manager/class/getClassByUniversityId",{params:{universityId:i}})}const fe=[{title:"学号",dataIndex:"studentNo",key:"studentNo",align:"center"},{title:"姓名",dataIndex:"studentName",key:"studentName",align:"center"},{title:"性别",dataIndex:"studentGender",key:"studentGender",align:"center"},{title:"生日",dataIndex:"studentBirthday",key:"studentBirthday",align:"center"},{title:"年龄",dataIndex:"studentAge",key:"studentAge",align:"center"},{title:"班级",key:"className",customRender:i=>pe("span",i.record.classVO.className)}],te={async fetchStudentData(i,v,u){return S.post(`/manager/student/list/${i}/${v}`,u)},async addStudent(i){return S.post("/manager/student/add",i)}},_e=J({__name:"StudentComp",setup(i){const v=ne(),u=$({current:1,pageSize:10,total:0}),y=$({studentNo:"",studentName:"",studentGender:""}),c=$({studentNo:"",studentName:"",studentGender:"",studentAge:22,classId:1,studentBirthday:""}),h=_(!1),O=_([]),I=_([]),N=async()=>{if(!v.loginUserInfo||!v.loginUserInfo.universityId)return;const o=await oe(v.loginUserInfo.universityId);O.value=o.map(n=>({label:n.className,value:n.classId}))||[]},k=async()=>{u.current=1,await E()},A=async()=>{console.log(c);try{await te.addStudent(c),h.value=!1,f.success("添加学生成功"),await E()}catch(o){console.error("添加学生失败:",o)}},E=async()=>{const o=await te.fetchStudentData(u.current,u.pageSize,y);I.value=o.records,u.total=o.total},b=async()=>{await N(),await E()};return ae(()=>{b()}),(o,n)=>{const G=s("a-input"),p=s("a-form-item"),M=s("a-select"),x=s("a-button"),F=s("a-form"),q=s("a-table"),H=s("a-input-number"),z=s("a-select-option"),R=s("a-date-picker"),Z=s("a-modal");return m(),w(T,null,[e(F,{layout:"inline",onSubmit:le(k,["prevent"])},{default:l(()=>[e(p,{label:"学生姓名"},{default:l(()=>[e(G,{value:y.studentName,"onUpdate:value":n[0]||(n[0]=t=>y.studentName=t),placeholder:"请输入学生姓名（支持模糊搜索）","allow-clear":""},null,8,["value"])]),_:1}),e(p,{label:"学生学号"},{default:l(()=>[e(G,{value:y.studentNo,"onUpdate:value":n[1]||(n[1]=t=>y.studentNo=t),placeholder:"请输入学生学号","allow-clear":""},null,8,["value"])]),_:1}),e(p,{label:"学生班级"},{default:l(()=>[e(M,{value:y.classId,"onUpdate:value":n[2]||(n[2]=t=>y.classId=t),options:O.value,placeholder:"请选择学生班级","allow-clear":""},null,8,["value","options"])]),_:1}),e(p,null,{default:l(()=>[e(x,{type:"primary","html-type":"submit"},{default:l(()=>n[12]||(n[12]=[d("搜索",-1)])),_:1,__:[12]})]),_:1}),e(p,null,{default:l(()=>[e(x,{onClick:n[3]||(n[3]=t=>h.value=!0)},{default:l(()=>n[13]||(n[13]=[d("添加学生",-1)])),_:1,__:[13]})]),_:1})]),_:1}),e(q,{columns:ce(fe),"data-source":I.value},null,8,["columns","data-source"]),e(Z,{open:h.value,"onUpdate:open":n[11]||(n[11]=t=>h.value=t),title:"添加学生"},{footer:l(()=>[e(x,{onClick:n[10]||(n[10]=t=>h.value=!1)},{default:l(()=>n[16]||(n[16]=[d("取消",-1)])),_:1,__:[16]}),e(x,{type:"primary",onClick:A},{default:l(()=>n[17]||(n[17]=[d("提交",-1)])),_:1,__:[17]})]),default:l(()=>[n[18]||(n[18]=D("div",null,"添加学生表单",-1)),e(F,null,{default:l(()=>[e(p,{label:"学生学号"},{default:l(()=>[e(G,{value:c.studentNo,"onUpdate:value":n[4]||(n[4]=t=>c.studentNo=t),placeholder:"请输入学生学号","allow-clear":""},null,8,["value"])]),_:1}),e(p,{label:"学生姓名"},{default:l(()=>[e(G,{value:c.studentName,"onUpdate:value":n[5]||(n[5]=t=>c.studentName=t),placeholder:"请输入学生学号","allow-clear":""},null,8,["value"])]),_:1}),e(p,{label:"学生年龄"},{default:l(()=>[e(H,{value:c.studentAge,"onUpdate:value":n[6]||(n[6]=t=>c.studentAge=t),placeholder:"请输入学生学号","allow-clear":""},null,8,["value"])]),_:1}),e(p,{label:"学生姓名"},{default:l(()=>[e(M,{value:c.classId,"onUpdate:value":n[7]||(n[7]=t=>c.classId=t),options:O.value,placeholder:"请选择学生班级","allow-clear":""},null,8,["value","options"])]),_:1}),e(p,{label:"学生性别"},{default:l(()=>[e(M,{value:c.studentGender,"onUpdate:value":n[8]||(n[8]=t=>c.studentGender=t),placeholder:"请选择学生性别","allow-clear":""},{default:l(()=>[e(z,{value:"男"},{default:l(()=>n[14]||(n[14]=[d("男",-1)])),_:1,__:[14]}),e(z,{value:"女"},{default:l(()=>n[15]||(n[15]=[d("女",-1)])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),e(p,{label:"学生生日"},{default:l(()=>[e(R,{value:c.studentBirthday,"onUpdate:value":n[9]||(n[9]=t=>c.studentBirthday=t),picker:"month"},null,8,["value"])]),_:1})]),_:1})]),_:1,__:[18]},8,["open"])],64)}}});function ye(i){return S.post("/manager/teacher/edit",i)}function ge(i){return S.get("/manager/teacher/delete",{params:{teacherId:i}})}function Ce(i,v,u){return S.post(`/manager/teacher/list/${i}/${v}`,u)}function he(i){return S.get("/manager/course/getCourseByUniversityId",{params:{universityId:i}})}const Ne={key:0,style:{"margin-top":"16px"}},ke={key:1,style:{color:"red","margin-top":"16px"}},Ie=J({__name:"TeacherComp",setup(i){const v=ne(),u=_(!1),y=_([]),c=_([]),h=_([]),O=_(!1),I=_(""),N=$({current:1,pageSize:10,total:0,showTotal:t=>`共 ${t} 条`}),k=$({teacherNo:"",teacherName:"",teacherGender:""}),A=_([]),E=[{title:"教师编号",dataIndex:"teacherNo",key:"teacherNo"},{title:"姓名",dataIndex:"teacherName",key:"teacherName"},{title:"生日",dataIndex:"teacherBirthday",key:"teacherBirthday"},{title:"性别",dataIndex:"teacherGender",key:"teacherGender"},{title:"班级与课程",dataIndex:"teacherOwnerClassCourse",key:"courses"},{title:"操作",key:"actions",width:150}],b=_(!1),o=$({teacherId:0,teacherNo:"",teacherName:"",teacherBirthday:null,teacherGender:"",selectClassCourse:[]}),n=()=>{},G=t=>{t.file.status!=="uploading"&&console.log(t.file,t.fileList),t.file.status==="done"?(console.log(t.file.response,"上传结果"),t.file.response.code===200?(f.success("教师数据导入成功"),u.value=!1,p()):(I.value=t.file.response.message||"导入失败，请重试",f.error(I.value),h.value=[],u.value=!1,I.value="")):t.file.status==="error"&&f.error(`${t.file.name} file upload failed.`)},p=async()=>{try{const t=await Ce(N.current,N.pageSize,k);y.value=t.records,N.total=t.total}catch{f.error("加载教师列表失败")}},M=async()=>{try{const t=await oe(v.loginUserInfo?.universityId);A.value=t.map(a=>({label:a.className,value:a.classId}))}catch{f.error("班级数据加载失败")}},x=()=>{N.current=1,p()},F=t=>{N.current=t.current,N.pageSize=t.pageSize,p()},q=t=>{console.log(t),o.teacherId=t.teacherId,o.teacherNo=t.teacherNo,o.teacherName=t.teacherName,o.teacherGender=t.teacherGender,o.teacherBirthday=t.teacherBirthday?ve(t.teacherBirthday):null,o.selectClassCourse=t.teacherOwnerClassCourse,b.value=!0},H=async()=>{try{await ye({teacherId:o.teacherId,teacherNo:o.teacherNo,teacherName:o.teacherName,teacherGender:o.teacherGender,teacherBirthday:o.teacherBirthday?o.teacherBirthday.format("YYYY-MM-DD"):null,selectClassCourse:o.selectClassCourse}),f.success("编辑成功"),b.value=!1,p()}catch{f.error("编辑失败")}},z=async()=>{try{const t=await he(v.loginUserInfo?.universityId);console.log(t,"res"),c.value=t.map(a=>({label:a.courseName,value:a.id}))}catch{f.error("课程数据加载失败")}},R=()=>{b.value=!1},Z=t=>{me.confirm({title:"确认删除该教师吗？",async onOk(){try{await ge(t),f.success("删除成功"),p()}catch{f.error("删除失败")}}})};return ae(()=>{p(),M(),z()}),(t,a)=>{const L=s("a-input"),g=s("a-form-item"),V=s("a-select-option"),Y=s("a-select"),U=s("a-button"),K=s("a-form"),re=s("a-tag"),Q=s("a-space"),se=s("a-table"),ue=s("a-upload"),W=s("a-modal"),de=s("a-date-picker"),ie=s("a-card");return m(),w("div",null,[e(K,{layout:"inline",onSubmit:le(x,["prevent"])},{default:l(()=>[e(g,{label:"教师编号"},{default:l(()=>[e(L,{value:k.teacherNo,"onUpdate:value":a[0]||(a[0]=r=>k.teacherNo=r),placeholder:"请输入教师编号","allow-clear":""},null,8,["value"])]),_:1}),e(g,{label:"教师姓名"},{default:l(()=>[e(L,{value:k.teacherName,"onUpdate:value":a[1]||(a[1]=r=>k.teacherName=r),placeholder:"请输入教师姓名","allow-clear":""},null,8,["value"])]),_:1}),e(g,{label:"性别"},{default:l(()=>[e(Y,{value:k.teacherGender,"onUpdate:value":a[2]||(a[2]=r=>k.teacherGender=r),placeholder:"选择性别","allow-clear":"",style:{width:"120px"}},{default:l(()=>[e(V,{value:"男"},{default:l(()=>a[13]||(a[13]=[d("男",-1)])),_:1,__:[13]}),e(V,{value:"女"},{default:l(()=>a[14]||(a[14]=[d("女",-1)])),_:1,__:[14]})]),_:1},8,["value"])]),_:1}),e(g,null,{default:l(()=>[e(U,{type:"primary",onClick:x},{default:l(()=>a[15]||(a[15]=[d("查询",-1)])),_:1,__:[15]})]),_:1}),e(g,null,{default:l(()=>[e(U,{onClick:a[3]||(a[3]=r=>u.value=!0)},{default:l(()=>a[16]||(a[16]=[d("导入教师数据",-1)])),_:1,__:[16]})]),_:1}),e(g,null,{default:l(()=>a[17]||(a[17]=[D("a",{href:"/ai-grader-front/file/teacher-upload.xlsx",download:"教师上传模板.xlsx"},"下载示例模板",-1)])),_:1,__:[17]})]),_:1}),e(se,{columns:E,"data-source":y.value,pagination:N,"row-key":"teacherId",bordered:"",onChange:F,style:{"margin-top":"16px"}},{bodyCell:l(({column:r,record:B})=>[r.key==="courses"?(m(),P(Q,{key:0,wrap:""},{default:l(()=>[(m(!0),w(T,null,X(B.teacherOwnerClassCourse,C=>(m(),P(re,{key:`${C.classId}-${C.courseId}`},{default:l(()=>[d(j(C.className)+" - "+j(C.courseName),1)]),_:2},1024))),128))]),_:2},1024)):r.key==="actions"?(m(),P(Q,{key:1},{default:l(()=>[e(U,{type:"link",onClick:C=>q(B)},{default:l(()=>a[18]||(a[18]=[d("编辑",-1)])),_:2,__:[18]},1032,["onClick"]),e(U,{type:"link",danger:"",onClick:C=>Z(B.teacherId)},{default:l(()=>a[19]||(a[19]=[d("删除",-1)])),_:2,__:[19]},1032,["onClick"])]),_:2},1024)):(m(),w(T,{key:2},[d(j(B[r.dataIndex]),1)],64))]),_:1},8,["data-source","pagination"]),e(W,{open:u.value,"onUpdate:open":a[5]||(a[5]=r=>u.value=r),title:"导入教师数据",onOk:n,onCancel:a[6]||(a[6]=()=>u.value=!1),"ok-text":"确定","cancel-text":"取消"},{default:l(()=>[e(ue,{action:"http://localhost:8080/manager/teacher/addByExcel",accept:".xlsx, .xls","file-list":h.value,"onUpdate:fileList":a[4]||(a[4]=r=>h.value=r),name:"file",onChange:G},{default:l(()=>[e(U,{type:"primary"},{default:l(()=>a[20]||(a[20]=[d("选择文件",-1)])),_:1,__:[20]})]),_:1},8,["file-list"]),O.value?(m(),w("div",Ne,"正在上传...")):ee("",!0),I.value?(m(),w("div",ke,j(I.value),1)):ee("",!0)]),_:1},8,["open"]),e(W,{open:b.value,"onUpdate:open":a[12]||(a[12]=r=>b.value=r),title:"编辑教师",onOk:H,onCancel:R,destroyOnClose:""},{default:l(()=>[e(K,{model:o,"label-col":{span:5},"wrapper-col":{span:16}},{default:l(()=>[e(g,{label:"教师编号"},{default:l(()=>[e(L,{value:o.teacherNo,"onUpdate:value":a[7]||(a[7]=r=>o.teacherNo=r)},null,8,["value"])]),_:1}),e(g,{label:"姓名"},{default:l(()=>[e(L,{value:o.teacherName,"onUpdate:value":a[8]||(a[8]=r=>o.teacherName=r)},null,8,["value"])]),_:1}),e(g,{label:"生日"},{default:l(()=>[e(de,{value:o.teacherBirthday,"onUpdate:value":a[9]||(a[9]=r=>o.teacherBirthday=r),style:{width:"100%"}},null,8,["value"])]),_:1}),e(g,{label:"性别"},{default:l(()=>[e(Y,{value:o.teacherGender,"onUpdate:value":a[10]||(a[10]=r=>o.teacherGender=r),style:{width:"100%"}},{default:l(()=>[e(V,{value:"男"},{default:l(()=>a[21]||(a[21]=[d("男",-1)])),_:1,__:[21]}),e(V,{value:"女"},{default:l(()=>a[22]||(a[22]=[d("女",-1)])),_:1,__:[22]})]),_:1},8,["value"])]),_:1}),a[25]||(a[25]=D("div",null,"教师授课情况",-1)),(m(!0),w(T,null,X(o.selectClassCourse,(r,B)=>(m(),P(ie,{key:B},{default:l(()=>[D("div",null,[e(Y,{value:r.classId,"onUpdate:value":C=>r.classId=C,"show-search":"",options:A.value,placeholder:"选择教师的班级",style:{width:"200px"}},null,8,["value","onUpdate:value","options"]),e(Y,{value:r.courseId,"onUpdate:value":C=>r.courseId=C,"show-search":"",options:c.value,placeholder:"选择教师的课程",style:{width:"200px"}},null,8,["value","onUpdate:value","options"]),e(U,{onClick:()=>o.selectClassCourse.splice(B,1)},{default:l(()=>a[23]||(a[23]=[d("删除",-1)])),_:2,__:[23]},1032,["onClick"])])]),_:2},1024))),128)),e(U,{onClick:a[11]||(a[11]=()=>o.selectClassCourse.push({className:"",courseName:""}))},{default:l(()=>a[24]||(a[24]=[d("新增",-1)])),_:1,__:[24]})]),_:1,__:[25]},8,["model"])]),_:1},8,["open"])])}}}),qe=J({__name:"PeopleManage",setup(i){return(v,u)=>(m(),w(T,null,[u[0]||(u[0]=D("div",{class:"ant-h2-title"}," 教师管理 ",-1)),e(Ie),u[1]||(u[1]=D("div",{class:"ant-h2-title"}," 学生管理 ",-1)),e(_e)],64))}});export{qe as default};
