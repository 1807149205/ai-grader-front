import{a as L}from"./axios-NIGUFBhG.js";import{a as m}from"./ant-design-vue-6d-v1kss.js";import{u as S,r as N}from"./index-bs4FdrbJ.js";import{d as R,r as g,a as j,a1 as B,c as o,$ as t,Z as l,_ as v,Y as E,a5 as I,G as w,a4 as b}from"./@vue-Y5XmvbFy.js";import{_ as P}from"./plugin-vueexport-helper-DlAUqK2U.js";import"./@babel-Bq4_u9L9.js";import"./@ant-design-Dt46iyJC.js";import"./@ctrl-DOFZgDuz.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion-BtrR-yrm.js";import"./stylis-D5iaQeiq.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-99Xd1yP8.js";import"./dom-align-CRCehRfe.js";import"./lodash-es-DnYq9fPm.js";import"./dayjs-Ct77qKTJ.js";import"./async-validator-CRx4dHSJ.js";import"./throttle-debounce-CUWDS_la.js";import"./pinia-D7EVXsHe.js";import"./vue-router-Bz8znIRM.js";const c=L.create({baseURL:"http://localhost:8080",timeout:1e4});c.interceptors.request.use(e=>e,e=>Promise.reject(e));c.interceptors.response.use(e=>{const n=e.data;return n.code!==200?(console.error(n.msg||"请求失败"),m.error(n.msg||"请求失败"),Promise.reject(new Error(n.msg||"请求失败"))):n.data},e=>(console.error("网络错误",e),Promise.reject(e)));function V(e){return c.post("/user/login",e)}function D(e){return c.post("/user/register",e)}const M={class:"login-container"},A=R({__name:"LoginRegister",setup(e){const n=S(),a=g(!0),r=j({username:"",password:"",role:""}),y={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!1}]},i=g(!1);function U(){a.value=!a.value}async function h(){i.value=!0;try{if(a.value){const s=(await V({username:r.username,password:r.password})).data;n.setLoginUserInfo(s),m.success("登录成功"),await N.push("/")}else{if(!r.role){m.error("请输入角色"),i.value=!1;return}await D({username:r.username,password:r.password,role:r.role}),m.success("注册成功"),a.value=!0}}catch{}finally{i.value=!1}}return(d,s)=>{const _=l("a-input"),p=l("a-form-item"),k=l("a-input-password"),f=l("a-button"),x=l("a-space"),q=l("a-form"),C=l("a-card");return v(),B("div",M,[o(C,{class:"login-card",title:a.value?"用户登录":"用户注册"},{default:t(()=>[o(q,{model:r,rules:y,layout:"vertical",onFinish:h},{default:t(()=>[o(p,{label:"用户名",name:"username"},{default:t(()=>[o(_,{value:r.username,"onUpdate:value":s[0]||(s[0]=u=>r.username=u),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),o(p,{label:"密码",name:"password"},{default:t(()=>[o(k,{value:r.password,"onUpdate:value":s[1]||(s[1]=u=>r.password=u),placeholder:"请输入密码"},null,8,["value"])]),_:1}),a.value?I("",!0):(v(),E(p,{key:0,label:"角色",name:"role"},{default:t(()=>[o(_,{value:r.role,"onUpdate:value":s[2]||(s[2]=u=>r.role=u),placeholder:"请输入角色，例如 USER 或 ADMIN"},null,8,["value"])]),_:1})),o(p,null,{default:t(()=>[o(x,null,{default:t(()=>[o(f,{type:"primary","html-type":"submit",loading:i.value},{default:t(()=>[w(b(a.value?"登录":"注册"),1)]),_:1},8,["loading"]),o(f,{type:"link",onClick:U},{default:t(()=>[w(b(a.value?"没有账号？去注册":"已有账号？去登录"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])])}}}),le=P(A,[["__scopeId","data-v-d36c2837"]]);export{le as default};
